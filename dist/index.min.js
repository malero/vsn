var S=(s=>(s.Whitespace="Whitespace",s.Identifier="Identifier",s.Number="Number",s.String="String",s.Boolean="Boolean",s.Null="Null",s.Behavior="Behavior",s.State="State",s.On="On",s.LBrace="LBrace",s.RBrace="RBrace",s.LParen="LParen",s.RParen="RParen",s.LBracket="LBracket",s.RBracket="RBracket",s.Colon="Colon",s.Semicolon="Semicolon",s.Comma="Comma",s.Dot="Dot",s.Hash="Hash",s.Greater="Greater",s.Less="Less",s.Plus="Plus",s.Tilde="Tilde",s.Star="Star",s.Equals="Equals",s.Bang="Bang",s.At="At",s.Dollar="Dollar",s.Question="Question",s))(S||{});var N={behavior:"Behavior",state:"State",on:"On",true:"Boolean",false:"Boolean",null:"Null"},p=class{constructor(e){this.input=e}index=0;line=1;column=1;tokenize(){let e=[];for(;!this.eof();){let t=this.peek();if(this.isWhitespace(t)){e.push(this.readWhitespace());continue}if(t==="/"&&this.peek(1)==="/"){this.readLineComment();continue}if(t==="/"&&this.peek(1)==="*"){this.readBlockComment();continue}if(this.isAlpha(t)||t==="_"){e.push(this.readIdentifier());continue}if(this.isDigit(t)||t==="-"&&this.isDigit(this.peek(1))){e.push(this.readNumber());continue}if(t==='"'||t==="'"){e.push(this.readString());continue}let r=this.readPunctuator();if(r){e.push(r);continue}throw new Error(`Unexpected character '${t}' at ${this.line}:${this.column}`)}return e}readWhitespace(){let e=this.position(),t="";for(;!this.eof()&&this.isWhitespace(this.peek());)t+=this.next();return this.token("Whitespace",t,e)}readLineComment(){for(this.next(),this.next();!this.eof()&&this.peek()!==`
`;)this.next()}readBlockComment(){for(this.next(),this.next();!this.eof();){if(this.peek()==="*"&&this.peek(1)==="/"){this.next(),this.next();return}this.next()}}readIdentifier(){let e=this.position(),t="";for(;!this.eof()&&(this.isAlphaNumeric(this.peek())||this.peek()==="_"||this.peek()==="-");)t+=this.next();let r=N[t];return r?this.token(r,t,e):this.token("Identifier",t,e)}readNumber(){let e=this.position(),t="";for(this.peek()==="-"&&(t+=this.next());!this.eof()&&this.isDigit(this.peek());)t+=this.next();if(this.peek()===".")for(t+=this.next();!this.eof()&&this.isDigit(this.peek());)t+=this.next();return this.token("Number",t,e)}readString(){let e=this.next(),t=this.position(),r="";for(;!this.eof();){let i=this.next();if(i==="\\"){let c=this.next();r+=c;continue}if(i===e)return this.token("String",r,t);r+=i}throw new Error(`Unterminated string at ${t.line}:${t.column}`)}readPunctuator(){let e=this.position(),t=this.peek(),i={"{":"LBrace","}":"RBrace","(":"LParen",")":"RParen","[":"LBracket","]":"RBracket",":":"Colon",";":"Semicolon",",":"Comma",".":"Dot","#":"Hash",">":"Greater","<":"Less","+":"Plus","~":"Tilde","*":"Star","=":"Equals","!":"Bang","@":"At",$:"Dollar","?":"Question"}[t];return i?(this.next(),this.token(i,t,e)):null}token(e,t,r){return{type:e,value:t,start:r,end:this.position()}}position(){return{index:this.index,line:this.line,column:this.column}}peek(e=0){return this.input[this.index+e]??""}next(){let e=this.input[this.index++]??"";return e===`
`?(this.line+=1,this.column=1):this.column+=1,e}eof(){return this.index>=this.input.length}isWhitespace(e){return e===" "||e==="	"||e===`
`||e==="\r"}isAlpha(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"}isDigit(e){return e>="0"&&e<="9"}isAlphaNumeric(e){return this.isAlpha(e)||this.isDigit(e)}};var o=class{constructor(e){this.type=e}async prepare(e){}async evaluate(e){}},h=class extends o{constructor(t){super("Program");this.behaviors=t}},u=class extends o{constructor(t){super("Block");this.statements=t}},l=class extends o{constructor(t){super("Selector");this.selectorText=t}},m=class extends o{constructor(t,r){super("Behavior");this.selector=t;this.body=r}},x=class extends o{constructor(t,r,i){super("StateEntry");this.name=t;this.value=r;this.important=i}},d=class extends o{constructor(t){super("StateBlock");this.entries=t}},k=class extends o{constructor(t,r,i){super("OnBlock");this.eventName=t;this.args=r;this.body=i}},f=class extends o{constructor(t,r){super("Assignment");this.target=t;this.value=r}},v=class extends o{constructor(t){super("Identifier");this.name=t}},a=class extends o{constructor(t){super("Literal");this.value=t}async evaluate(){return this.value}},w=class extends o{constructor(t,r){super("UnaryExpression");this.operator=t;this.argument=r}},g=class extends o{constructor(t,r){super("Directive");this.kind=t;this.name=r}},b=class extends o{constructor(t,r){super("Query");this.direction=t;this.selector=r}};var B=class{constructor(e){this.tokens=e}index=0;peek(e=0){return this.tokens[this.index+e]??null}next(){let e=this.tokens[this.index++];if(!e)throw new Error("Unexpected end of input");return e}eof(){return this.index>=this.tokens.length}match(e){return this.peek()?.type===e?(this.next(),!0):!1}expect(e){let t=this.next();if(t.type!==e)throw new Error(`Expected ${e} but got ${t.type}`);return t}skipWhitespace(){for(;this.peek()?.type==="Whitespace";)this.next()}};var E=class{stream;constructor(e){let t=new p(e);this.stream=new B(t.tokenize())}parseProgram(){let e=[];for(this.stream.skipWhitespace();!this.stream.eof();)e.push(this.parseBehavior()),this.stream.skipWhitespace();return new h(e)}parseBehavior(){this.stream.skipWhitespace(),this.stream.expect("Behavior");let e=this.parseSelector(),t=this.parseBlock();return new m(e,t)}parseSelector(){let e="",t=!1;for(;;){let r=this.stream.peek();if(!r||r.type==="LBrace")break;if(r.type==="Whitespace"){this.stream.next(),t&&e[e.length-1]!==" "&&(e+=" ");continue}t=!0,e+=this.stream.next().value}if(!e.trim())throw new Error("Behavior selector is required");return new l(e.trim())}parseBlock(){this.stream.skipWhitespace(),this.stream.expect("LBrace");let e=[];for(;;){this.stream.skipWhitespace();let t=this.stream.peek();if(!t)throw new Error("Unterminated block");if(t.type==="RBrace"){this.stream.next();break}e.push(this.parseStatement())}return new u(e)}parseStatement(){this.stream.skipWhitespace();let e=this.stream.peek();if(!e)throw new Error("Unexpected end of input");if(e.type==="State")return this.parseStateBlock();if(e.type==="On")return this.parseOnBlock();if(e.type==="Behavior")return this.parseBehavior();if(e.type==="Identifier"&&this.stream.peek(1)?.type==="Equals")return this.parseAssignment();throw new Error(`Unexpected token ${e.type}`)}parseStateBlock(){this.stream.expect("State"),this.stream.skipWhitespace(),this.stream.expect("LBrace");let e=[];for(;;){this.stream.skipWhitespace();let t=this.stream.peek();if(!t)throw new Error("Unterminated state block");if(t.type==="RBrace"){this.stream.next();break}let r=this.stream.expect("Identifier");this.stream.skipWhitespace(),this.stream.expect("Colon"),this.stream.skipWhitespace();let i=this.parseExpression();this.stream.skipWhitespace();let c=!1;if(this.stream.peek()?.type==="Bang"){this.stream.next(),this.stream.skipWhitespace();let y=this.stream.next();if(y.type==="Identifier"&&y.value==="important")c=!0;else throw new Error("Expected 'important' after '!'")}this.stream.skipWhitespace(),this.stream.expect("Semicolon"),e.push(new x(r.value,i,c))}return new d(e)}parseOnBlock(){this.stream.expect("On"),this.stream.skipWhitespace();let e=this.stream.expect("Identifier");this.stream.skipWhitespace(),this.stream.expect("LParen");let t=[];for(;;){this.stream.skipWhitespace();let i=this.stream.peek();if(!i)throw new Error("Unterminated on() arguments");if(i.type==="RParen"){this.stream.next();break}if(i.type==="Identifier"){t.push(this.stream.next().value),this.stream.skipWhitespace(),this.stream.peek()?.type==="Comma"&&this.stream.next();continue}throw new Error(`Unexpected token in on() args: ${i.type}`)}let r=this.parseBlock();return new k(e.value,t,r)}parseAssignment(){let e=this.stream.expect("Identifier");this.stream.skipWhitespace(),this.stream.expect("Equals"),this.stream.skipWhitespace();let t=this.parseExpression();return this.stream.skipWhitespace(),this.stream.expect("Semicolon"),new f(e.value,t)}parseExpression(){let e=this.stream.peek();if(!e)throw new Error("Expected expression");if(e.type==="Bang"){this.stream.next();let t=this.parseExpression();return new w("!",t)}if(e.type==="At"||e.type==="Dollar"){let t=e.type==="At"?"attr":"style";this.stream.next();let r=this.stream.expect("Identifier");return new g(t,r.value)}if(e.type==="Question")return this.parseQueryExpression();if(e.type==="Identifier")return new v(this.stream.next().value);if(e.type==="Boolean")return new a(this.stream.next().value==="true");if(e.type==="Null")return this.stream.next(),new a(null);if(e.type==="Number")return new a(Number(this.stream.next().value));if(e.type==="String")return new a(this.stream.next().value);throw new Error(`Unsupported expression token ${e.type}`)}parseQueryExpression(){this.stream.expect("Question");let e="self";this.stream.peek()?.type==="Greater"?(this.stream.next(),e="descendant"):this.stream.peek()?.type==="Less"&&(this.stream.next(),e="ancestor"),this.stream.skipWhitespace(),this.stream.expect("LParen");let t=this.readSelectorUntil("RParen");return new b(e,t)}readSelectorUntil(e){let t="",r=!1;for(;;){let i=this.stream.peek();if(!i)throw new Error("Unterminated selector");if(i.type===e){this.stream.next();break}if(i.type==="Whitespace"){this.stream.next(),r&&t[t.length-1]!==" "&&(t+=" ");continue}r=!0,t+=this.stream.next().value}return t.trim()}};var O="0.1.0";function Q(n){return new E(n).parseProgram()}export{f as AssignmentNode,o as BaseNode,m as BehaviorNode,u as BlockNode,g as DirectiveExpression,v as IdentifierExpression,p as Lexer,a as LiteralExpression,k as OnBlockNode,E as Parser,h as ProgramNode,b as QueryExpression,l as SelectorNode,d as StateBlockNode,x as StateEntryNode,S as TokenType,w as UnaryExpression,O as VERSION,Q as parseCFS};
//# sourceMappingURL=index.min.js.map