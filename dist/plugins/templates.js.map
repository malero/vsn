{"version":3,"sources":["../../src/plugins/templates.ts"],"sourcesContent":["import type { Engine } from \"../runtime/engine\";\n\ntype TemplateResult = {\n  __vsnTemplate: true;\n  strings: string[];\n  values: any[];\n};\n\ntype TemplateInstance = {\n  strings: string[];\n  textParts: Map<number, PartSlot>;\n  attrParts: AttributePart[];\n};\n\ntype PartSlot = {\n  marker: Comment;\n  nodes: Node[];\n};\n\ntype AttributePart = {\n  element: Element;\n  name: string;\n  strings: string[];\n  indices: number[];\n};\n\nexport function registerTemplates(engine: Engine): void {\n  const htmlBindings = new WeakMap<Element, string>();\n  const templateInstances = new WeakMap<Element, TemplateInstance>();\n  const handleHtmlBehaviors = (engine as any).handleHtmlBehaviors?.bind(engine);\n\n  engine.registerGlobal(\"html\", html);\n\n  patchAttributeHandlers(engine, htmlBindings, templateInstances, handleHtmlBehaviors);\n  patchDirectiveSetter(engine, templateInstances, handleHtmlBehaviors);\n  patchEvaluate(engine, htmlBindings, templateInstances, handleHtmlBehaviors);\n}\n\nexport default registerTemplates;\n\nconst globals = globalThis as Record<string, any>;\nconst plugins = globals.VSNPlugins ?? {};\nplugins.templates = (instance: Engine) => registerTemplates(instance);\nglobals.VSNPlugins = plugins;\n\nconst autoEngine = globals.VSNEngine;\nif (autoEngine && typeof autoEngine.registerGlobal === \"function\") {\n  registerTemplates(autoEngine as Engine);\n}\n\nfunction html(stringsOrValue: TemplateStringsArray | string, ...values: any[]): TemplateResult {\n  if (Array.isArray(stringsOrValue)) {\n    return {\n      __vsnTemplate: true,\n      strings: Array.from(stringsOrValue),\n      values\n    };\n  }\n  return {\n    __vsnTemplate: true,\n    strings: [String(stringsOrValue)],\n    values: []\n  };\n}\n\nfunction isTemplate(value: any): value is TemplateResult {\n  return Boolean(value && typeof value === \"object\" && value.__vsnTemplate);\n}\n\nfunction renderValue(value: any): string {\n  if (value == null) {\n    return \"\";\n  }\n  if (isTemplate(value)) {\n    return renderTemplate(value);\n  }\n  if (Array.isArray(value)) {\n    return value.map(renderValue).join(\"\");\n  }\n  if (value instanceof Element) {\n    return value.outerHTML;\n  }\n  return String(value);\n}\n\nfunction renderTemplate(template: TemplateResult): string {\n  const { strings, values } = template;\n  let output = \"\";\n  for (let i = 0; i < strings.length; i += 1) {\n    output += strings[i] ?? \"\";\n    if (i < values.length) {\n      output += renderValue(values[i]);\n    }\n  }\n  return output;\n}\n\nfunction renderToString(value: any): string {\n  if (isTemplate(value) || Array.isArray(value) || value instanceof Element) {\n    return renderValue(value);\n  }\n  return value == null ? \"\" : String(value);\n}\n\nfunction renderHtml(\n  element: Element,\n  value: any,\n  instances: WeakMap<Element, TemplateInstance>,\n  handleHtmlBehaviors?: (root: Element) => void\n): void {\n  if (!(element instanceof HTMLElement)) {\n    return;\n  }\n  if (isTemplate(value)) {\n    const instance = instances.get(element);\n    if (instance && sameTemplate(instance.strings, value.strings)) {\n      updateInstance(instance, value);\n      return;\n    }\n    const next = buildInstance(value);\n    instances.set(element, next);\n    element.innerHTML = \"\";\n    element.appendChild(next.fragment);\n    updateInstance(next, value);\n    handleHtmlBehaviors?.(element);\n    return;\n  }\n  instances.delete(element);\n  element.innerHTML = renderToString(value);\n  handleHtmlBehaviors?.(element);\n}\n\nfunction sameTemplate(a: string[], b: string[]): boolean {\n  if (a.length !== b.length) {\n    return false;\n  }\n  for (let i = 0; i < a.length; i += 1) {\n    if (a[i] !== b[i]) {\n      return false;\n    }\n  }\n  return true;\n}\n\nfunction buildInstance(template: TemplateResult): TemplateInstance & { fragment: DocumentFragment } {\n  const strings = template.strings.slice();\n  const textParts = new Map<number, PartSlot>();\n  const attrParts: AttributePart[] = [];\n  const html = buildTemplateHtml(strings);\n  const container = document.createElement(\"template\");\n  container.innerHTML = html;\n  const fragment = container.content;\n  collectTextParts(fragment, textParts);\n  collectAttributeParts(fragment, attrParts);\n  return { strings, textParts, attrParts, fragment };\n}\n\nfunction buildTemplateHtml(strings: string[]): string {\n  let output = strings[0] ?? \"\";\n  for (let i = 1; i < strings.length; i += 1) {\n    output += `__vsn-part-${i - 1}__${strings[i] ?? \"\"}`;\n  }\n  return output;\n}\n\nfunction parsePartIndexToken(value: string): number | undefined {\n  const match = value.match(/^__vsn-part-(\\d+)__$/);\n  if (!match) {\n    return undefined;\n  }\n  return Number(match[1]);\n}\n\nfunction collectTextParts(fragment: DocumentFragment, textParts: Map<number, PartSlot>): void {\n  const walker = document.createTreeWalker(fragment, NodeFilter.SHOW_TEXT, null);\n  let node = walker.nextNode();\n  while (node) {\n    const textNode = node as Text;\n    const value = textNode.textContent ?? \"\";\n    if (value.includes(\"__vsn-part-\")) {\n      const pieces = splitByPartTokens(value);\n      if (pieces) {\n        const replacement = document.createDocumentFragment();\n        for (const piece of pieces) {\n          if (piece.type === \"text\") {\n            replacement.appendChild(document.createTextNode(piece.value));\n          } else {\n            const marker = document.createComment(`vsn-part-${piece.index}`);\n            textParts.set(piece.index, { marker, nodes: [] });\n            replacement.appendChild(marker);\n          }\n        }\n        const next = walker.nextNode();\n        textNode.replaceWith(replacement);\n        node = next;\n        continue;\n      }\n    }\n    node = walker.nextNode();\n  }\n}\n\nfunction collectAttributeParts(fragment: DocumentFragment, attrParts: AttributePart[]): void {\n  const walker = document.createTreeWalker(fragment, NodeFilter.SHOW_ELEMENT, null);\n  let node = walker.nextNode();\n  while (node) {\n    const element = node as Element;\n    for (const attr of Array.from(element.attributes)) {\n      if (!attr.value.includes(\"__vsn-part-\")) {\n        continue;\n      }\n      const parsed = parseAttributeParts(attr.value);\n      if (!parsed) {\n        continue;\n      }\n      attrParts.push({ element, name: attr.name, strings: parsed.strings, indices: parsed.indices });\n    }\n    node = walker.nextNode();\n  }\n}\n\nfunction splitByPartTokens(value: string):\n  | { type: \"text\"; value: string }[]\n  | { type: \"part\"; index: number }[]\n  | ( { type: \"text\"; value: string } | { type: \"part\"; index: number } )[]\n  | null {\n  const parts: Array<{ type: \"text\"; value: string } | { type: \"part\"; index: number }> = [];\n  const regex = /__vsn-part-(\\d+)__/g;\n  let lastIndex = 0;\n  let match: RegExpExecArray | null;\n  while ((match = regex.exec(value))) {\n    const start = match.index;\n    if (start > lastIndex) {\n      parts.push({ type: \"text\", value: value.slice(lastIndex, start) });\n    }\n    const index = Number(match[1]);\n    if (Number.isFinite(index)) {\n      parts.push({ type: \"part\", index });\n    }\n    lastIndex = regex.lastIndex;\n  }\n  if (parts.length === 0) {\n    return null;\n  }\n  if (lastIndex < value.length) {\n    parts.push({ type: \"text\", value: value.slice(lastIndex) });\n  }\n  return parts;\n}\n\nfunction parseAttributeParts(value: string): { strings: string[]; indices: number[] } | null {\n  const regex = /__vsn-part-(\\d+)__/g;\n  let lastIndex = 0;\n  const strings: string[] = [];\n  const indices: number[] = [];\n  let match: RegExpExecArray | null;\n  while ((match = regex.exec(value))) {\n    strings.push(value.slice(lastIndex, match.index));\n    indices.push(Number(match[1]));\n    lastIndex = regex.lastIndex;\n  }\n  if (indices.length === 0) {\n    return null;\n  }\n  strings.push(value.slice(lastIndex));\n  return { strings, indices };\n}\n\nfunction updateInstance(instance: TemplateInstance, template: TemplateResult): void {\n  for (const [index, slot] of instance.textParts.entries()) {\n    const value = template.values[index];\n    updatePart(slot, value);\n  }\n  for (const part of instance.attrParts) {\n    let value = part.strings[0] ?? \"\";\n    for (let i = 0; i < part.indices.length; i += 1) {\n      const index = part.indices[i];\n      if (index === undefined) {\n        continue;\n      }\n      const nextValue = template.values[index];\n      value += renderValue(nextValue);\n      value += part.strings[i + 1] ?? \"\";\n    }\n    part.element.setAttribute(part.name, value);\n  }\n}\n\nfunction updatePart(slot: PartSlot, value: any): void {\n  if (!slot.marker.parentNode) {\n    return;\n  }\n  for (const node of slot.nodes) {\n    node.parentNode?.removeChild(node);\n  }\n  slot.nodes = [];\n  const fragment = document.createDocumentFragment();\n  if (value == null) {\n    // no-op\n  } else if (isTemplate(value)) {\n    const html = renderTemplate(value);\n    slot.nodes = appendHtml(fragment, html);\n  } else if (Array.isArray(value)) {\n    const html = value.map(renderValue).join(\"\");\n    slot.nodes = appendHtml(fragment, html);\n  } else if (value instanceof Element) {\n    fragment.appendChild(value);\n    slot.nodes = [value];\n  } else {\n    const text = document.createTextNode(String(value));\n    fragment.appendChild(text);\n    slot.nodes = [text];\n  }\n  slot.marker.after(fragment);\n}\n\nfunction appendHtml(fragment: DocumentFragment, html: string): Node[] {\n  const container = document.createElement(\"template\");\n  container.innerHTML = html;\n  const nodes = Array.from(container.content.childNodes);\n  fragment.appendChild(container.content);\n  return nodes;\n}\n\nfunction patchAttributeHandlers(\n  engine: Engine,\n  htmlBindings: WeakMap<Element, string>,\n  instances: WeakMap<Element, TemplateInstance>,\n  handleHtmlBehaviors?: (root: Element) => void\n): void {\n  const handlers: any[] = (engine as any).attributeHandlers ?? [];\n  (engine as any).attributeHandlers = handlers.filter((handler) => handler?.id !== \"vsn-html\");\n\n  engine.registerAttributeHandler({\n    id: \"vsn-html\",\n    match: (name) => name.startsWith(\"vsn-html\"),\n    handle: (element, _name, value, scope) => {\n      htmlBindings.set(element, value);\n      if ((engine as any).markInlineDeclaration) {\n        (engine as any).markInlineDeclaration(element, \"attr:html\");\n      }\n      const apply = () => {\n        const htmlValue = scope.get(value);\n        renderHtml(element, htmlValue, instances, handleHtmlBehaviors);\n      };\n      apply();\n      if ((engine as any).watch) {\n        (engine as any).watch(scope, value, apply, element);\n      }\n      return true;\n    }\n  });\n}\n\nfunction patchDirectiveSetter(\n  engine: Engine,\n  instances: WeakMap<Element, TemplateInstance>,\n  handleHtmlBehaviors?: (root: Element) => void\n): void {\n  const originalSet = (engine as any).setDirectiveValue?.bind(engine);\n  if (!originalSet) {\n    return;\n  }\n  (engine as any).setDirectiveValue = (element: Element, target: any, value: any) => {\n    if (target?.kind === \"attr\" && target?.name === \"html\") {\n      renderHtml(element, value, instances, handleHtmlBehaviors);\n      return;\n    }\n    return originalSet(element, target, value);\n  };\n}\n\nfunction patchEvaluate(\n  engine: Engine,\n  htmlBindings: WeakMap<Element, string>,\n  instances: WeakMap<Element, TemplateInstance>,\n  handleHtmlBehaviors?: (root: Element) => void\n): void {\n  const originalEvaluate = engine.evaluate.bind(engine);\n  engine.evaluate = (element: Element) => {\n    originalEvaluate(element);\n    const binding = htmlBindings.get(element);\n    if (!binding) {\n      return;\n    }\n    const scope = engine.getScope(element);\n    const htmlValue = scope.get(binding);\n    renderHtml(element, htmlValue, instances, handleHtmlBehaviors);\n  };\n}\n"],"mappings":"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","names":["html","html"]}