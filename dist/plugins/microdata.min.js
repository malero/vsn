var A="@type";function p(t){t.registerBehaviorModifier("microdata",{onBind:({element:n,scope:i,args:r})=>{let e=E(r),o=l(n);if(!o)return;let s=d(o,e);I(i,s,e)}}),t.registerGlobal("microdata",(n,i)=>{let r=E(u(n)?n:i),e=T(t,n);if(!e)return;let o=d(l(e)??e,r);return typeof n=="string"&&!u(i)?o[n]:o})}var R=p,y=globalThis,g=y.VSNPlugins??{};g.microdata=t=>p(t);y.VSNPlugins=g;var f=y.VSNEngine;f&&typeof f.registerBehaviorModifier=="function"&&p(f);function E(t){if(!t)return{};if(typeof t=="string")return{key:t};if(u(t)){let n={};return typeof t.key=="string"&&(n.key=t.key),typeof t.flatten=="boolean"&&(n.flatten=t.flatten),n}return{}}function u(t){return!!t&&typeof t=="object"&&!Array.isArray(t)}function T(t,n){return n?n instanceof Element?n:Array.isArray(n)&&n[0]instanceof Element?n[0]:t.getCurrentElement():t.getCurrentElement()}function l(t){return t.hasAttribute("itemscope")?t:t.querySelector("[itemscope]")??void 0}function d(t,n){let i={},r=t.getAttribute("itemtype"),e=t.getAttribute("itemid");return r&&(i[A]=r),e&&(i["@id"]=e),M(t,i,n),i}function M(t,n,i){let r=Array.from(t.children);for(let e of r){let o=e.hasAttribute("itemprop"),s=e.hasAttribute("itemscope");if(!(s&&!o)){if(o){let b=(e.getAttribute("itemprop")??"").split(/\s+/).map(c=>c.trim()).filter(Boolean),a=s?d(e,i):x(e);for(let c of b)m(n,c,a);if(i.flatten&&a&&typeof a=="object"&&!Array.isArray(a))for(let[c,h]of Object.entries(a))c.startsWith("@")||m(n,c,h);if(s)continue}M(e,n,i)}}}function x(t){return t instanceof HTMLMetaElement?t.content??"":t instanceof HTMLInputElement||t instanceof HTMLTextAreaElement||t instanceof HTMLSelectElement?t.value??"":t instanceof HTMLTimeElement?t.dateTime||t.getAttribute("datetime")||"":t instanceof HTMLAnchorElement||t instanceof HTMLLinkElement?t.getAttribute("href")??"":t instanceof HTMLImageElement?t.getAttribute("src")??"":t.hasAttribute("content")?t.getAttribute("content")??"":(t.textContent??"").trim()}function m(t,n,i){if(t[n]===void 0){t[n]=i;return}if(Array.isArray(t[n])){t[n].push(i);return}t[n]=[t[n],i]}function I(t,n,i){if(i.key){t.setPath?.(i.key,n);return}for(let[r,e]of Object.entries(n)){if(r===A){t.setPath?.("itemtype",e);continue}if(r==="@id"){t.setPath?.("itemid",e);continue}t.setPath?.(r,e)}}export{R as default,p as registerMicrodata};
//# sourceMappingURL=microdata.min.js.map