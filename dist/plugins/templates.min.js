function f(t){let n=new WeakMap,e=new WeakMap,r=t.handleHtmlBehaviors?.bind(t);t.registerGlobal("html",b),H(t,n,e,r),W(t,e,r),w(t,n,e,r)}var D=f,g=globalThis,T=g.VSNPlugins??{};T.templates=t=>f(t);g.VSNPlugins=T;var p=g.VSNEngine;p&&typeof p.registerGlobal=="function"&&f(p);function b(t,...n){return Array.isArray(t)?{__vsnTemplate:!0,strings:Array.from(t),values:n}:{__vsnTemplate:!0,strings:[String(t)],values:[]}}function d(t){return!!(t&&typeof t=="object"&&t.__vsnTemplate)}function u(t){return t==null?"":d(t)?E(t):Array.isArray(t)?t.map(u).join(""):t instanceof Element?t.outerHTML:String(t)}function E(t){let{strings:n,values:e}=t,r="";for(let a=0;a<n.length;a+=1)r+=n[a]??"",a<e.length&&(r+=u(e[a]));return r}function _(t){return d(t)||Array.isArray(t)||t instanceof Element?u(t):t==null?"":String(t)}function h(t,n,e,r){if(t instanceof HTMLElement){if(d(n)){let a=e.get(t);if(a&&A(a.strings,n.strings)){y(a,n);return}let s=N(n);e.set(t,s),t.innerHTML="",t.appendChild(s.fragment),y(s,n),r?.(t);return}e.delete(t),t.innerHTML=_(n),r?.(t)}}function A(t,n){if(t.length!==n.length)return!1;for(let e=0;e<t.length;e+=1)if(t[e]!==n[e])return!1;return!0}function N(t){let n=t.strings.slice(),e=new Map,r=[],a=P(n),s=document.createElement("template");s.innerHTML=a;let i=s.content;return k(i,e),S(i,r),{strings:n,textParts:e,attrParts:r,fragment:i}}function P(t){let n=t[0]??"";for(let e=1;e<t.length;e+=1)n+=`__vsn-part-${e-1}__${t[e]??""}`;return n}function k(t,n){let e=document.createTreeWalker(t,NodeFilter.SHOW_TEXT,null),r=e.nextNode();for(;r;){let a=r,s=a.textContent??"";if(s.includes("__vsn-part-")){let i=v(s);if(i){let o=document.createDocumentFragment();for(let l of i)if(l.type==="text")o.appendChild(document.createTextNode(l.value));else{let m=document.createComment(`vsn-part-${l.index}`);n.set(l.index,{marker:m,nodes:[]}),o.appendChild(m)}let c=e.nextNode();a.replaceWith(o),r=c;continue}}r=e.nextNode()}}function S(t,n){let e=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,null),r=e.nextNode();for(;r;){let a=r;for(let s of Array.from(a.attributes)){if(!s.value.includes("__vsn-part-"))continue;let i=I(s.value);i&&n.push({element:a,name:s.name,strings:i.strings,indices:i.indices})}r=e.nextNode()}}function v(t){let n=[],e=/__vsn-part-(\d+)__/g,r=0,a;for(;a=e.exec(t);){let s=a.index;s>r&&n.push({type:"text",value:t.slice(r,s)});let i=Number(a[1]);Number.isFinite(i)&&n.push({type:"part",index:i}),r=e.lastIndex}return n.length===0?null:(r<t.length&&n.push({type:"text",value:t.slice(r)}),n)}function I(t){let n=/__vsn-part-(\d+)__/g,e=0,r=[],a=[],s;for(;s=n.exec(t);)r.push(t.slice(e,s.index)),a.push(Number(s[1])),e=n.lastIndex;return a.length===0?null:(r.push(t.slice(e)),{strings:r,indices:a})}function y(t,n){for(let[e,r]of t.textParts.entries()){let a=n.values[e];M(r,a)}for(let e of t.attrParts){let r=e.strings[0]??"";for(let a=0;a<e.indices.length;a+=1){let s=e.indices[a];if(s===void 0)continue;let i=n.values[s];r+=u(i),r+=e.strings[a+1]??""}e.element.setAttribute(e.name,r)}}function M(t,n){if(!t.marker.parentNode)return;for(let r of t.nodes)r.parentNode?.removeChild(r);t.nodes=[];let e=document.createDocumentFragment();if(n!=null)if(d(n)){let r=E(n);t.nodes=x(e,r)}else if(Array.isArray(n)){let r=n.map(u).join("");t.nodes=x(e,r)}else if(n instanceof Element)e.appendChild(n),t.nodes=[n];else{let r=document.createTextNode(String(n));e.appendChild(r),t.nodes=[r]}t.marker.after(e)}function x(t,n){let e=document.createElement("template");e.innerHTML=n;let r=Array.from(e.content.childNodes);return t.appendChild(e.content),r}function H(t,n,e,r){let a=t.attributeHandlers??[];t.attributeHandlers=a.filter(s=>s?.id!=="vsn-html"),t.registerAttributeHandler({id:"vsn-html",match:s=>s.startsWith("vsn-html"),handle:(s,i,o,c)=>{n.set(s,o),t.markInlineDeclaration&&t.markInlineDeclaration(s,"attr:html");let l=()=>{let m=c.get(o);h(s,m,e,r)};return l(),t.watch&&t.watch(c,o,l,s),!0}})}function W(t,n,e){let r=t.setDirectiveValue?.bind(t);r&&(t.setDirectiveValue=(a,s,i)=>{if(s?.kind==="attr"&&s?.name==="html"){h(a,i,n,e);return}return r(a,s,i)})}function w(t,n,e,r){let a=t.evaluate.bind(t);t.evaluate=s=>{a(s);let i=n.get(s);if(!i)return;let c=t.getScope(s).get(i);h(s,c,e,r)}}export{D as default,f as registerTemplates};
//# sourceMappingURL=templates.min.js.map