var v="__vsnTrustedHtml";function h(t,n={}){let e=new WeakMap,l=new WeakSet,s=W(n),i=t.handleHtmlBehaviors?.bind(t);t.registerFlag("trusted",{transformValue:({declaration:r},a)=>{let o=r?.target;return o?.type==="Directive"&&o?.name==="html"?{[v]:!0,value:a}:a}}),b(t,e,l,s,i),H(t,l,s,i),w(t,e,l,s,i),T(t,l)}var A=h,E=globalThis,S=E.VSNPlugins??{};S.sanitizeHtml=t=>h(t);E.VSNPlugins=S;var g=E.VSNEngine;g&&typeof g.registerFlag=="function"&&h(g);function b(t,n,e,l,s){let i=t.attributeHandlers??[];t.attributeHandlers=i.filter(r=>r?.id!=="vsn-html"&&r?.id!=="vsn-get"),t.registerAttributeHandler({id:"vsn-html",match:r=>r.startsWith("vsn-html"),handle:(r,a,o,u)=>{let c=a.includes("!trusted");n.set(r,{expr:o,trusted:c}),t.markInlineDeclaration&&t.markInlineDeclaration(r,"attr:html");let d=()=>{let f=u.get(o),m=f==null?"":String(f);r.innerHTML=c?m:l(m),c&&(e.add(r),s?.(r))};return d(),t.watch&&t.watch(u,o,d,r),!0}}),t.registerAttributeHandler({id:"vsn-get",match:r=>r.startsWith("vsn-get"),handle:(r,a)=>{let o=a.includes("!trusted"),u=a.includes("!load"),c=r.getAttribute(a)??"",d=r.getAttribute("vsn-target")??void 0,f=r.getAttribute("vsn-swap")??"inner",m=d??void 0,y=async()=>{try{await L(t,r,{url:c,swap:f,trusted:o,...m?{targetSelector:m}:{}},l,s,e)}catch(p){console.warn("vsn:getError",p),r.dispatchEvent(new CustomEvent("vsn:getError",{detail:{error:p},bubbles:!0}))}};return r.addEventListener("click",p=>{p.target===r&&y()}),u&&Promise.resolve().then(y),!0}})}function H(t,n,e,l){let s=t.setDirectiveValue?.bind(t);s&&(t.setDirectiveValue=(i,r,a)=>{if(r?.kind==="attr"&&r?.name==="html"&&i instanceof HTMLElement){let{html:o,trusted:u}=k(a,i,n);i.innerHTML=u?o:e(o),u&&l?.(i);return}return s(i,r,a)})}function w(t,n,e,l,s){let i=t.evaluate.bind(t);t.evaluate=r=>{i(r);let a=n.get(r);if(!a||!(r instanceof HTMLElement))return;let u=t.getScope(r).get(a.expr),c=u==null?"":String(u);r.innerHTML=a.trusted?c:l(c),a.trusted&&(e.add(r),s?.(r))}}function T(t,n){let e=t.applyBehaviorDeclaration?.bind(t);e&&(t.applyBehaviorDeclaration=async(l,s,i,r)=>{let a=i?.target;return i?.flags?.trusted&&a?.type==="Directive"&&a?.name==="html"&&n.add(l),e(l,s,i,r)})}function k(t,n,e){return t&&typeof t=="object"&&t[v]?{html:t.value==null?"":String(t.value),trusted:!0}:{html:t==null?"":String(t),trusted:e.has(n)}}async function L(t,n,e,l,s,i){if(!globalThis.fetch)throw new Error("fetch is not available");let r=await globalThis.fetch(e.url);if(!r||!r.ok)return;let a=await r.text(),o=M(n,e.targetSelector);if(!o){n.dispatchEvent(new CustomEvent("vsn:targetError",{detail:{selector:e.targetSelector}}));return}let u=e.trusted?a:l(a);if(e.swap==="outer"){let c=document.createElement("div");c.innerHTML=u;let d=c.firstElementChild;d&&o.parentNode&&(o.parentNode.replaceChild(d,o),e.trusted&&(i?.add(d),s?.(d)));return}o.innerHTML=u,e.trusted&&(i?.add(o),s?.(o))}function M(t,n){return n?t.ownerDocument.querySelector(n):t}function W(t){if(t.sanitizer)return t.sanitizer;let n=globalThis.DOMPurify;return n&&typeof n.sanitize=="function"?e=>n.sanitize(e,t.dompurifyConfig??{}):z}function z(t){if(typeof document>"u")return t.replace(/<script\b[^>]*>[\s\S]*?<\/script>/gi,"");let n=document.createElement("template");n.innerHTML=t,n.content.querySelectorAll("script").forEach(s=>s.remove());let l=n.content.querySelectorAll("*");for(let s of Array.from(l))for(let i of Array.from(s.attributes)){let r=i.name.toLowerCase(),a=i.value;if(r.startsWith("on")){s.removeAttribute(i.name);continue}(r==="href"||r==="src")&&a.trim().toLowerCase().startsWith("javascript:")&&s.removeAttribute(i.name)}return n.innerHTML}export{A as default,h as registerSanitizeHtml};
//# sourceMappingURL=sanitize-html.min.js.map